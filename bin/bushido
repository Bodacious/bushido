#!/usr/bin/env ruby



require "thor"
require 'active_support/core_ext/string'



class Generate < Thor

  include Thor::Actions

  attr_accessor :title
  
  attr_accessor :category
  
  # attr_accessor :author_name
  
  attr_accessor :permalink
  
  attr_accessor :filename

  source_root File.join(File.dirname(__FILE__), '..', 'lib/bushido/generate')
  
  desc "generate tenet TYPE TITLE", 
    "Create a new tenet file of type TYPE with name YYYY-MM-DD-TITLE.md"

  long_desc <<-LONGDESC
    Will create a new tenet for the site. 

    Tenet files are compiled by Jekyll, so they require a specific naming format: YYYY-MM-DD-TITLE.md

    Will create tenet under the given TYPE.

    Will create a new directory for TYPE if one doesn't already exist.
    LONGDESC

  
  def tenet(category, title)
    self.title       = title.underscore
    self.category    = category.underscore
    # self.
    self.permalink   = title.to_s.gsub(/[^\w]/, '-').downcase
    
    self.filename    = "#{Date.today}-#{permalink}.md"
    
    template 'templates/tenet.md.erb',
      "_posts/#{category.downcase}/#{filename}"
  end
  
  
  private
  
  
  def author_name 
    `whoami`.chomp
  end

end
  
class Bushido < Thor
    
  desc "generate FILETYPE ...ARGS", "Generates a file for the bushido repository"
  subcommand "generate", Generate
    
end

Bushido.start(ARGV)